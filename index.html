<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Through the Ages – Prototype</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --bg:#1e1e1e;
  --surface:#2a2a2a;
  --surface-alt:#333;
  --border:#555;
  --accent:#8ab4f8;
}
html,body{
  height:100%;
  margin:0;
  background:var(--bg);
  color:#e0e0e0;
  font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
  display:flex;
  flex-direction:column;
}
/* ─── header reserve ─── */
header{
  flex:0 0 60px;
  display:flex;
  align-items:center;
  padding:0 1rem;
  background:var(--surface);
  border-bottom:1px solid var(--border);
}
header h1{font-size:1rem;font-weight:600}

/* ─── board ─── */
#board{
  flex:1 1 auto;
  display:grid;
  gap:4px;
  padding:10px;
  background:var(--surface-alt);
}
.cell{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:4px;
  position:relative;
  aspect-ratio:1/1;     /* keep every space square */
}
.cell.highlight{
  outline:2px dashed var(--accent);
  outline-offset:-2px;
}

/* ─── hand ─── */
#hand{
  flex:0 0 160px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:0.5rem;
  padding:0.5rem;
  background:var(--surface);
  border-top:1px solid var(--border);
}
.card{
  width:80px;
  height:120px;
  background:#444;
  border:2px solid var(--accent);
  border-radius:6px;
  cursor:grab;
  user-select:none;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:.8rem;
  text-align:center;
  transition:transform .05s;
}
.card.dragging{
  opacity:.7;
  cursor:grabbing;
  transform:rotate(3deg);
}
</style>
</head>
<body>
<header><h1>Through the Ages – Prototype</h1></header>

<main id="board"></main>

<section id="hand"></section>

<!-- PapaParse for CSV import -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
/* ─── grid size ─── */
const boardCols = 8;
const boardRows = 10;

/* build board */
const board = document.getElementById('board');
board.style.gridTemplateColumns = `repeat(${boardCols},1fr)`;
board.style.gridTemplateRows   = `repeat(${boardRows},1fr)`;
for (let r = 0; r < boardRows; r++){
  for (let c = 0; c < boardCols; c++){
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.row = r;
    cell.dataset.col = c;
    board.appendChild(cell);
  }
}

/* hand zone – create seven blanks now, we’ll swap text after CSV loads */
const hand = document.getElementById('hand');
for (let i = 0; i < 7; i++){
  const card = document.createElement('div');
  card.className = 'card';
  card.textContent = 'Blank';
  hand.appendChild(card);
}

/* drag & drop (unchanged) */
let dragged = null;
document.addEventListener('pointerdown', e=>{
  if(!e.target.classList.contains('card')) return;
  dragged = e.target;
  dragged.classList.add('dragging');
  dragged.setPointerCapture(e.pointerId);
});
document.addEventListener('pointermove', e=>{
  if(!dragged) return;
  dragged.style.position='fixed';
  dragged.style.left=(e.clientX-40)+'px';
  dragged.style.top =(e.clientY-60)+'px';
  document.querySelectorAll('.cell.highlight').forEach(c=>c.classList.remove('highlight'));
  const cell = document.elementFromPoint(e.clientX,e.clientY);
  if(cell?.classList.contains('cell') && cell.children.length===0) cell.classList.add('highlight');
});
document.addEventListener('pointerup', e=>{
  if(!dragged) return;
  dragged.releasePointerCapture(e.pointerId);
  const cell = document.elementFromPoint(e.clientX,e.clientY);
  const valid = cell?.classList.contains('cell') && cell.children.length===0;
  if(valid){
    cell.appendChild(dragged);
    Object.assign(dragged.style,{position:'absolute',left:'4px',top:'4px'});
  }else{
    hand.appendChild(dragged);
    dragged.style.position='static';
  }
  dragged.classList.remove('dragging');
  dragged=null;
  document.querySelectorAll('.cell.highlight').forEach(c=>c.classList.remove('highlight'));
});

/* ─── CSV loader: pick 7 random names for the hand ─── */
function loadCardsFromCSV(path){
  Papa.parse(path,{
    download:true,
    header:true,
    skipEmptyLines:true,
    complete:res=>{
      const rows = res.data.filter(r=>Object.keys(r).length);          // ignore blank lines
      if(rows.length===0){console.warn('CSV loaded but empty');return}

      // Guess the name field: prefer "Name", otherwise first column
      const headers = Object.keys(rows[0]);
      const nameKey = headers.find(h=>/name/i.test(h)) || headers[0];

      // choose 7 random rows (no duplicates)
      const randomRows = [];
      const pool = [...rows];
      for(let i=0;i<7 && pool.length;i++){
        const idx = Math.floor(Math.random()*pool.length);
        randomRows.push(pool.splice(idx,1)[0]);
      }

      // replace the hand card labels
      [...hand.children].forEach((card,i)=>{
        card.textContent = randomRows[i]?.[nameKey] || 'Unknown';
      });

      console.log('Sample hand populated with random names from', path);
    }
  });
}

/*  ← uncomment this line once baseset1.csv is in the same folder →  */
loadCardsFromCSV('baseset1.csv');
</script>
</body>
</html>