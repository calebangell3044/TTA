<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Through the Ages – Prototype</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
/* ───────  Dark-mode palette  ─────── */
:root{
  --bg:#1e1e1e;
  --surface:#2a2a2a;
  --surface-alt:#333;
  --border:#555;
  --accent:#8ab4f8;
}
/* ───────  Page layout  ─────── */
html,body{
  height:100%;
  margin:0;
  background:var(--bg);
  color:#e0e0e0;
  font-family:'Segoe UI',Tahoma,Verdana,sans-serif;
  display:flex;
  flex-direction:column;
}
/* header reserve – tweak height if you need more space later */
header{
  flex:0 0 60px;
  display:flex;
  align-items:center;
  padding:0 1rem;
  background:var(--surface);
  border-bottom:1px solid var(--border);
}
header h1{
  font-size:1rem;
  font-weight:600;
}
/* main board area – grid size is JS-controlled */
#board{
  flex:1 1 auto;
  display:grid;
  gap:4px;
  padding:10px;
  background:var(--surface-alt);
}
.cell{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:4px;
  position:relative;
}
.cell.highlight{
  outline:2px dashed var(--accent);
  outline-offset:-2px;
}
/* hand zone */
#hand{
  flex:0 0 160px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:0.5rem;
  padding:0.5rem;
  background:var(--surface);
  border-top:1px solid var(--border);
}
.card{
  width:80px;
  height:120px;
  background:#444;
  border:2px solid var(--accent);
  border-radius:6px;
  cursor:grab;
  user-select:none;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:.8rem;
  text-align:center;
  transition:transform .05s;
}
.card.dragging{
  opacity:.7;
  cursor:grabbing;
  transform:rotate(3deg);
}
</style>
</head>
<body>
<header>
  <h1>Through the Ages – Prototype</h1>
</header>

<main id="board"></main>

<section id="hand"></section>

<!-- PapaParse for future CSV imports -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
/* ───────  Config  ─────── */
const boardCols = 8;   // change when the rulebook defines exact grid
const boardRows = 5;

/* ───────  Build the board  ─────── */
const board = document.getElementById('board');
board.style.gridTemplateColumns = `repeat(${boardCols}, 1fr)`;
board.style.gridTemplateRows   = `repeat(${boardRows}, 1fr)`;

for (let r = 0; r < boardRows; r++) {
  for (let c = 0; c < boardCols; c++) {
    const cell = document.createElement('div');
    cell.className = 'cell';
    cell.dataset.row = r;
    cell.dataset.col = c;
    board.appendChild(cell);
  }
}

/* ───────  Populate starting hand  ─────── */
const hand = document.getElementById('hand');
for (let i = 0; i < 7; i++) {
  const card = document.createElement('div');
  card.className = 'card';
  card.textContent = 'Blank';
  hand.appendChild(card);
}

/* ───────  Drag-and-drop logic (pointer events)  ─────── */
let draggedCard = null;

document.addEventListener('pointerdown', e => {
  if (!e.target.classList.contains('card')) return;
  draggedCard = e.target;
  draggedCard.classList.add('dragging');
  draggedCard.setPointerCapture(e.pointerId);
});

document.addEventListener('pointermove', e => {
  if (!draggedCard) return;
  draggedCard.style.position = 'fixed';
  draggedCard.style.left = (e.clientX - 40) + 'px';
  draggedCard.style.top  = (e.clientY - 60) + 'px';

  /* highlight cell under pointer */
  document.querySelectorAll('.cell.highlight').forEach(c => c.classList.remove('highlight'));
  const cell = document.elementFromPoint(e.clientX, e.clientY);
  if (cell?.classList.contains('cell')) cell.classList.add('highlight');
});

document.addEventListener('pointerup', e => {
  if (!draggedCard) return;
  draggedCard.releasePointerCapture(e.pointerId);

  const cell = document.elementFromPoint(e.clientX, e.clientY);
  const validTarget = cell?.classList.contains('cell') && cell.children.length === 0;

  if (validTarget) {
    cell.appendChild(draggedCard);
    draggedCard.style.position = 'absolute';
    draggedCard.style.left = '4px';
    draggedCard.style.top  = '4px';
  } else {
    hand.appendChild(draggedCard);
    draggedCard.style.position = 'static';
  }

  draggedCard.classList.remove('dragging');
  draggedCard = null;
  document.querySelectorAll('.cell.highlight').forEach(c => c.classList.remove('highlight'));
});

/* ───────  CSV loader stub – ready for when you drop baseset1.csv in  ─────── */
function loadCardsFromCSV(path){
  Papa.parse(path, {
    download: true,
    header: true,
    complete: results => {
      console.log('CSV loaded', results.data);
      // TODO: replace blanks with actual card elements
    }
  });
}

// Example usage (uncomment after you add the CSV):
// loadCardsFromCSV('baseset1.csv');
</script>
</body>
</html>